---
os: linux
dist: bionic

addons:
  ssh_known_hosts: ${DEPLOY_HOST}

language: node_js
node_js:
  - lts/*

install:
  - wget "https://github.com/gohugoio/hugo/releases/download/v${HUGO_RELEASE}/hugo_extended_${HUGO_RELEASE}_Linux-64bit.deb"
  - sudo dpkg -i hugo*.deb
  - npm install

script:
  - hugo version
  - hugo --minify

before_deploy:
  - openssl aes-256-cbc -K $encrypted_db2095f63ba3_key -iv $encrypted_db2095f63ba3_iv -in deploy_rsa.enc -out /tmp/deploy_rsa -d
  - eval "$(ssh-agent -s)"
  - chmod 600 /tmp/deploy_rsa
  - ssh-add /tmp/deploy_rsa
  - echo -e "Host ${DEPLOY_HOST}\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config

deploy:
  provider: script
  skip_cleanup: true
  script: rsync -r --quiet --delete ${TRAVIS_BUILD_DIR}/public/ ${DEPLOY_USER}@${DEPLOY_HOST}:${DEPLOY_DIRECTORY}
  on:
    branch: master

env:
  global:
    - PRODUCTION=true
    - HUGO_RELEASE=0.68.3
    - secure: "UI8gyoJqkxuCdDb7dY3DVLyfOzc+9EZkbiQsBNT0JXry5ib3krwDtvvwZmyjyJ6hEWdCEYhLHbmoptNBIBFP05ZOnWD8kruO20NpYYJvBbTXBIpSCV2aIkNUCdiEC6ZTAKDmY1WGLgahobmFmEeS8yvFmGmGCQ5LK70ufQ6pvfaH3ra0QYgOHsWDFNbRqK8B34gHxPfu3ECv9d/p7E/dJlusUX3oCAgFK+zHL53RWy+Oz7eHhQSlU2OY5G/dthY2CqWwDq3CfijJvjnNoJWyBiSKoxIyNNXYcldKDB0CQT2C2dQFMf+1x0hKCoRhU0ZUXWAP908PcvZjx7kq/QP3eQBzlOTOGg9ysGqDV49Axwr+VLDgHydqUrh2gw6N+sSFSQQY+6RnzkTNdJDU+L0hRu5GbH+uF9hdt9Botg9bGojTkRIjZEZ3xTBMKUPBvyuOrZ6j28Vo8ubss7t4SQFBPegCF4QPT2FVrlvRh5JgqElyX5sfsmhqDN1bu0sRE501DdWarfkOBYMRQZGWYkMOh8eYOn/lYbRvbCpipx8fhIKMjPI8OSYlVfw3BAxMWFYsqNg184IQXfJSg3pnitDUTSbzceqXiqXMUA6fXEqr9QgI8C/wW/IbcmvKxj+Yw2jnatAyj1qG0mn6+pXGrTs4fAK6k/m6Arlaoiq/dAXfGx8="
    - secure: "o7w0nq6Alx4vxItjyGa2jyL3zTVdH6PO/VcbQBP3/NaQUxHaWIvV8UDe3Af4y4WEezNxErlfWCv5HiMfeTdxu9OQAT+LggJsMTN3RTV3RZrOuZ5oQtCsUt+jH/xDXk8dG++IUpa7K+yu4amymvD+UZ33z+KrIN9fnJTwicC6xmI88+UgjgS/FZCmIRWktHfxCe0c1m8v+Xm3UJBB+59Cs04YI4kwZZWsMJal8In+Zdi0+5CobJrOBgzjKWbGWw/gf1AbAVgzl/70ayr/CxQHH56961YPXopqluQ+zZl1sbZ36RBs+dKkCiOzTVG+avPOmEn3A634scqoKwyRuJ7SC/dU6NU9LTmTwRi72Z/xrGLM0qEzwipZwP8JxcpENM1SenSZomAX100I8SYyF+RIWR3yjQ/namd1jc7tvxeGjtNL1IV3fs81m5M3L4b5/ccL8mws4yeXTWCRs64k6CbNKogIQV5MML0yXfggPnq8oOg6UpJqGJSjs+IhIioq9sZ5YwA+YFPyQGW38K1pKnbOlYckupJNreecehPuKoKcjN2hH22tEJBVRUxFe4DOWpU65cO9Rri/d3XMBo68Rq5o3dWqSGEyrKE8KYVXxUpwbbg1a+Jp6J5c7g4FSQPVjeiXDr6qVSbUDWeO21LBVA8g5hZSQGa67IJ05lY4pvyElkE="
    - secure: "YXYGQbgTX12l1lLYEjvMdCkJF4qqthwHjiliQ4qWYmKk7NU8wk8V8Ihu7h12iYQApWEwhD0k9smt3AQ26+ZJxjpvsXSr1sDK9FvxFXxpiHqOyPROEOZqtwlVEvWYTDMyF71Jk3CYfVHZ+wHDCEe8pNTwjBCTzdks49IH0LZzxIs//9KslVooAvuusXo78wgzW975AnDlij2ZdkG3IyLTido/ACP7DnkjIjrretDThs37gKA3S26xbdF8ErOGuDxhV1ji7Ak31pVAPKe4WuDh83fT5b+9V9XAjvatWLPtLpBUHCJAOnFtjh/1eICo72IRWAi63pkdWQVtzG40o2YU+wbxva8ag5CYuFyh2FJfRQar/sv1BzNQn+VoZ86myFeZgFE0H0KGZShELAOivV+wJIyhBUp45cP0ex9awB/i6jJSK5juyK5caD2c7OWTxW1S5rcACDMcWEBVGxuHFFbNuQIAYY9T3mctrHkXeulQOFSQoG8iGd4WFxfxYXlxpKiL6u8ujcdn2zfPDPjYo/LSwfZoYo75uhn9fPs0QHYblYmxNonSHpzXK7OlF+uDKczYGvmEFpujEYuAS4slr1mVsJ8PQ361ZgkZnAYx1qPOesV9sqogYNg91bvfNwCqmVoCz/cWZRSYGIKJoaW6hvrf0OXpMmoSbttVs37HSCcsl3M="

cache:
  directories:
    - node_modules

notifications:
  email:
    on_success: never
